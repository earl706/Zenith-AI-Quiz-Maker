{"version":3,"names":["_axios","_interopRequireDefault","require","inProduction","import","meta","env","VITE_IN_PRODUCTION","productionAPIURL","VITE_PRODUCTION_API_URL","developmentAPIURL","VITE_DEVELOPMENT_API_URL","APIURL","API","axios","create","baseURL","isTokenExpired","token","payload","JSON","parse","atob","split","exp","Date","now","error","refreshAccessToken","refreshToken","localStorage","getItem","Error","response","post","refresh","data","access","setItem","removeItem","interceptors","request","use","config","window","location","href","Promise","reject","headers","Authorization","originalRequest","status","_retry","newToken","refreshError","_default","exports","default"],"sources":["api.jsx"],"sourcesContent":["import axios from 'axios';\n\nconst inProduction = import.meta.env.VITE_IN_PRODUCTION;\nconst productionAPIURL = import.meta.env.VITE_PRODUCTION_API_URL;\nconst developmentAPIURL = import.meta.env.VITE_DEVELOPMENT_API_URL;\n\nconst APIURL = inProduction == 'true' ? productionAPIURL : developmentAPIURL;\n\nconst API = axios.create({\n\tbaseURL: APIURL\n});\n\n// Token expiration check\nconst isTokenExpired = (token) => {\n\tif (!token) return true;\n\ttry {\n\t\tconst payload = JSON.parse(atob(token.split('.')[1]));\n\t\treturn payload.exp * 1000 < Date.now();\n\t} catch (error) {\n\t\treturn true;\n\t}\n};\n\n// Refresh token function\nconst refreshAccessToken = async () => {\n\tconst refreshToken = localStorage.getItem('zenithQuizMakerRefreshToken');\n\tif (!refreshToken) {\n\t\tthrow new Error('No refresh token available');\n\t}\n\n\ttry {\n\t\tconst response = await axios.post(`${APIURL}api/users/token/refresh/`, {\n\t\t\trefresh: refreshToken\n\t\t});\n\n\t\tif (response.data.access) {\n\t\t\tlocalStorage.setItem('zenithQuizMakerAccessToken', response.data.access);\n\t\t\tif (response.data.refresh) {\n\t\t\t\tlocalStorage.setItem('zenithQuizMakerRefreshToken', response.data.refresh);\n\t\t\t}\n\t\t\treturn response.data.access;\n\t\t}\n\t} catch (error) {\n\t\t// Clear tokens if refresh fails\n\t\tlocalStorage.removeItem('zenithQuizMakerAccessToken');\n\t\tlocalStorage.removeItem('zenithQuizMakerRefreshToken');\n\t\tlocalStorage.removeItem('userData');\n\t\tthrow error;\n\t}\n};\n\nAPI.interceptors.request.use(async (config) => {\n\tlet token = localStorage.getItem('zenithQuizMakerAccessToken');\n\n\tif (token && isTokenExpired(token)) {\n\t\ttry {\n\t\t\ttoken = await refreshAccessToken();\n\t\t} catch (error) {\n\t\t\t// Redirect to login or handle token refresh failure\n\t\t\twindow.location.href = '/login';\n\t\t\treturn Promise.reject(error);\n\t\t}\n\t}\n\n\tif (token) {\n\t\tconfig.headers.Authorization = `Bearer ${token}`;\n\t}\n\treturn config;\n});\n\n// Response interceptor to handle 401 errors\nAPI.interceptors.response.use(\n\t(response) => response,\n\tasync (error) => {\n\t\tconst originalRequest = error.config;\n\n\t\tif (error.response?.status === 401 && !originalRequest._retry) {\n\t\t\toriginalRequest._retry = true;\n\n\t\t\ttry {\n\t\t\t\tconst newToken = await refreshAccessToken();\n\t\t\t\toriginalRequest.headers.Authorization = `Bearer ${newToken}`;\n\t\t\t\treturn API(originalRequest);\n\t\t\t} catch (refreshError) {\n\t\t\t\t// Redirect to login if refresh fails\n\t\t\t\twindow.location.href = '/login';\n\t\t\t\treturn Promise.reject(refreshError);\n\t\t\t}\n\t\t}\n\n\t\treturn Promise.reject(error);\n\t}\n);\n\nexport default API;\n"],"mappings":"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","ignoreList":[]}